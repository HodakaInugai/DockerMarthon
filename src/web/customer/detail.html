<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Details</title>
    <!-- Bootstrap CSSの読み込み -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>

<body>
    <div class="container mt-5">
        <h2 class="mb-4">顧客詳細</h2>
        <div id="customer-details"></div>

        <!-- 更新ボタン -->
        <button type="button" class="btn btn-success mr-2" onclick="redirectToUpdate()">更新</button>

        <!-- 戻るボタンを追加 -->
        <button type="button" class="btn btn-primary mr-2" onclick="goBackToList()">戻る</button>

        <!-- 削除ボタン -->
    　　<button type="button" class="btn btn-danger mr-2" onclick="deleteCustomer()">削除</button>
    </div>

    <!-- 詳細ページのHTMLコード（一部省略） -->

<script type="module">
　  const apiUrl = '/api_hodaka_inugai';

    // URLから顧客IDを取得
    const urlParams = new URLSearchParams(window.location.search);
    const customerId = urlParams.get('id');

    // customerIdがnullまたはundefinedの場合にエラーハンドリングを追加
    if (customerId === null || customerId === undefined) {
        console.error('Error: Customer ID is null or undefined.');
    } else {
        console.log(customerId);

        // 顧客詳細を取得するためのURLを生成
        const apiUrl = '/api_hodaka_inugai';
        const customerDetailUrl = `${apiUrl}/api_hodaka_inugai/customer/${customerId}`;

        // 顧客詳細を取得
        fetch(customerDetailUrl)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                const customerDetails = document.getElementById('customer-details');

                if (customerDetails) {
                    const customer = data.customer;
                    customerDetails.innerHTML = `
                        <!-- 顧客詳細の表示コード（省略） -->
                    `;

                    // 削除ボタンの生成
                    const deleteButton = document.createElement("button");
                    deleteButton.textContent = "削除";
                    deleteButton.className = "btn btn-danger mr-2";
                    deleteButton.onclick = function () {
                        // 削除処理
                        deleteCustomer(customer.customer_id); // customer_id を渡す
                    };
                    customerDetails.appendChild(deleteButton);
                } else {
                    console.error('Error: Element with ID "customer-details" not found.');
                }
            })
            .catch(error => console.error('Error:', error));

    }

    // アップデートボタンを押したときに update.html に遷移
    function redirectToUpdate() {
        window.location.href = `/hodaka_inugai/customer/update.html?id=${customerId}`;
    }

    // 戻るボタンを押したときに一覧ページに遷移
    function goBackToList() {
        window.location.href = '/hodaka_inugai/customer/list.html';
    }

    // 顧客削除関数
    function deleteCustomer(id) {
        const confirmation = confirm("削除してもよろしいですか？");

        if (confirmation) {
            // フォームデータをサーバーに送信
            fetch(`${apiUrl}/api_hodaka_inugai/customer/${id}`, {
                method: 'DELETE',
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('顧客情報が正常に削除されました。');
                        // 削除後、一覧画面に遷移
                        window.location.href = '/hodaka_inugai/customer/list.html';
                    } else {
                        alert('削除に失敗しました。');
                    }
                })
                .catch(error => console.error('Error:', error));
        }
    }
</script>

<!-- 他のHTMLとBootstrapのスクリプト（省略） -->


    <!-- BootstrapのJavaScriptの読み込み -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>

</html>

